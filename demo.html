<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMB ERP & CRM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F6b936',  /* CMB Yellow */
              secondary: '#1F70D3', /* CMB Blue */
              danger: '#D60000',
              zohoDark: '#1c212e',
              zohoGray: '#f4f5f7'
            },
            fontFamily: {
              poppins: ['Poppins', 'sans-serif']
            }
          }
        }
      }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f5f7; }
        
        /* Sidebar Styling */
        .sidebar { transition: width 0.3s; width: 250px; background: #1c212e; color: #d4d6dc; height: 100vh; position: fixed; overflow-y: auto; }
        .sidebar-header { padding: 20px; font-weight: 700; font-size: 20px; color: white; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header span { color: #F6b936; }
        
        .menu-label { font-size: 11px; text-transform: uppercase; color: #6c757d; padding: 15px 20px 5px; font-weight: 700; letter-spacing: 1px; }
        
        .nav-item { padding: 10px 20px; display: flex; align-items: center; cursor: pointer; transition: 0.2s; font-size: 14px; border-left: 3px solid transparent; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: #fff; border-left-color: #F6b936; }
        .nav-item i { width: 25px; }

        .submenu { display: none; background: rgba(0,0,0,0.3); padding-left: 45px; }
        .submenu a { display: block; padding: 8px 0; font-size: 13px; color: #a0a6b5; cursor: pointer; }
        .submenu a:hover { color: #fff; }

        /* Main Content */
        .main-content { margin-left: 250px; width: calc(100% - 250px); min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { background: white; height: 60px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e5e7eb; }
        
        .content-area { padding: 25px; flex: 1; }
        
        /* Views */
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* CRM Highlight Box */
        .crm-highlight { background: linear-gradient(135deg, #1F70D3 0%, #16509c 100%); margin: 15px; padding: 15px; border-radius: 8px; border: 1px solid #F6b936; }
        .crm-highlight h4 { color: #F6b936; font-size: 12px; font-weight: 700; margin-bottom: 10px; }
        .crm-btn { display: flex; align-items: center; color: white; font-size: 12px; padding: 6px 0; cursor: pointer; }
        .crm-btn:hover { text-decoration: underline; }
        .crm-btn i { margin-right: 8px; width: 15px; }

        /* Loader */
        .loader { display: none; border: 3px solid #f3f3f3; border-top: 3px solid #F6b936; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">CMB <span>ERP</span></div>

        <div class="nav-item active" onclick="navigate('company-view', this)">
            <i class="fa-solid fa-building"></i> Company Creation
        </div>

        <div class="menu-label">Create</div>
        <div class="nav-item" onclick="toggleSub('sub-create')">
            <i class="fa-solid fa-plus-circle"></i> Create Masters <i class="fa-solid fa-chevron-down ml-auto text-xs"></i>
        </div>
        <div class="submenu" id="sub-create">
            <a onclick="navigate('ledger-view')">Ledgers</a>
            <a onclick="navigate('placeholder-view', null, 'Project Name')">Project Name</a>
            <a onclick="navigate('placeholder-view', null, 'Project Stage')">Project Stage</a>
            <a onclick="navigate('placeholder-view', null, 'Stock Items')">Stock Items</a>
        </div>

        <div class="menu-label">Transactions</div>
        <div class="nav-item" onclick="toggleSub('sub-accounts')">
            <i class="fa-solid fa-file-invoice-dollar"></i> Accounts Entry <i class="fa-solid fa-chevron-down ml-auto text-xs"></i>
        </div>
        <div class="submenu" id="sub-accounts">
            <a onclick="navigate('placeholder-view', null, 'Cash Book')">Cash Book</a>
            <a onclick="navigate('placeholder-view', null, 'Bank Book')">Bank Book</a>
            <a onclick="navigate('placeholder-view', null, 'Payment Voucher')">Payment</a>
            <a onclick="navigate('placeholder-view', null, 'Receipt Voucher')">Receipt</a>
            <a onclick="navigate('placeholder-view', null, 'Journal')">Journal</a>
            <a onclick="navigate('placeholder-view', null, 'Sales Invoice')">Sales / Invoice</a>
            <a onclick="navigate('placeholder-view', null, 'Credit Note')">Sales Return</a>
            <a onclick="navigate('placeholder-view', null, 'Debit Note')">Purchase Return</a>
            <a onclick="navigate('placeholder-view', null, 'Estimates')">Estimates</a>
        </div>

        <div class="menu-label">Reports</div>
        <div class="nav-item" onclick="toggleSub('sub-reports')">
            <i class="fa-solid fa-chart-pie"></i> Financial Reports <i class="fa-solid fa-chevron-down ml-auto text-xs"></i>
        </div>
        <div class="submenu" id="sub-reports">
            <a onclick="navigate('placeholder-view', null, 'Ledger Report')">Ledgerwise</a>
            <a onclick="navigate('placeholder-view', null, 'P&L Statement')">Profit & Loss</a>
            <a onclick="navigate('placeholder-view', null, 'Balance Sheet')">Balance Sheet</a>
            <a onclick="navigate('placeholder-view', null, 'GST Reports')">GST Reports (R1/3B/9)</a>
        </div>

        <div class="crm-highlight">
            <h4><i class="fa-solid fa-bolt"></i> SMART CRM / QR</h4>
            <div class="crm-btn" onclick="navigate('crm-view')"><i class="fa-brands fa-whatsapp"></i> Send Reminders</div>
            <div class="crm-btn" onclick="navigate('crm-view')"><i class="fa-solid fa-building-columns"></i> Send Bank Details</div>
            <div class="crm-btn" onclick="navigate('crm-view')"><i class="fa-solid fa-qrcode"></i> Generate QR</div>
        </div>

        <div class="menu-label">Settings</div>
        <div class="nav-item" onclick="navigate('users-view', this)">
            <i class="fa-solid fa-users-cog"></i> User Management
        </div>
    </aside>

    <main class="main-content">
        <div class="top-bar">
            <h2 id="page-title" class="text-lg font-semibold text-gray-700">Company Creation</h2>
            <div class="flex items-center gap-3">
                <span class="text-sm font-medium text-gray-500">FY: 2025-2026</span>
                <div class="w-8 h-8 rounded-full bg-secondary text-white flex items-center justify-center font-bold">A</div>
            </div>
        </div>

        <div class="content-area">
            
            <div id="company-view" class="view-section active">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 max-w-4xl mx-auto">
                    <h3 class="text-lg font-semibold text-secondary mb-4 border-b pb-2">Company Information</h3>
                    <form id="form-company" onsubmit="submitData(event, 'save_company', 'form-company')">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">Company Name</label>
                                <input type="text" name="Company Name" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary" required>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">Mailing Name</label>
                                <input type="text" name="Mailing Name" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary">
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">State</label>
                                <select name="State" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary">
                                    <option>Kerala</option>
                                    <option>Tamil Nadu</option>
                                    <option>Karnataka</option>
                                    <option>Delhi</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">GSTIN</label>
                                <input type="text" name="GSTIN" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary" placeholder="29ABCDE1234F1Z5">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">Financial Year From</label>
                                <input type="date" name="Financial Year Beginning From" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary" value="2025-04-01">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-600 mb-1">Address</label>
                            <textarea name="Address Line 1" rows="3" class="w-full border p-2 rounded text-sm focus:outline-none focus:border-secondary"></textarea>
                        </div>
                        <div class="flex items-center">
                            <button type="submit" class="bg-secondary text-white px-6 py-2 rounded text-sm font-semibold hover:bg-blue-700 transition">Save Company</button>
                            <div class="loader" id="loader-form-company"></div>
                        </div>
                    </form>
                </div>
            </div>

            <div id="ledger-view" class="view-section">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 max-w-2xl mx-auto">
                    <h3 class="text-lg font-semibold text-secondary mb-4 border-b pb-2">Create Ledger</h3>
                    <form id="form-ledger" onsubmit="submitData(event, 'save_ledger', 'form-ledger')">
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-600 mb-1">Ledger Name</label>
                            <input type="text" name="ledgerName" class="w-full border p-2 rounded text-sm" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-600 mb-1">Under Group</label>
                            <select name="group" class="w-full border p-2 rounded text-sm">
                                <option>Sundry Debtors</option>
                                <option>Sundry Creditors</option>
                                <option>Bank Accounts</option>
                                <option>Sales Accounts</option>
                                <option>Purchase Accounts</option>
                                <option>Indirect Expenses</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">State</label>
                                <input type="text" name="state" class="w-full border p-2 rounded text-sm" value="Kerala">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">GSTIN (If Applicable)</label>
                                <input type="text" name="gstin" class="w-full border p-2 rounded text-sm">
                            </div>
                        </div>
                        <div class="flex items-center">
                            <button type="submit" class="bg-secondary text-white px-6 py-2 rounded text-sm font-semibold">Create Ledger</button>
                            <div class="loader" id="loader-form-ledger"></div>
                        </div>
                    </form>
                </div>
            </div>

            <div id="crm-view" class="view-section">
                <div class="grid grid-cols-2 gap-6 max-w-5xl mx-auto">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="text-lg font-semibold text-green-600 mb-4"><i class="fa-brands fa-whatsapp"></i> WhatsApp Communicator</h3>
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-600 mb-1">Customer Mobile (with Country Code)</label>
                            <input type="number" id="wa-mobile" class="w-full border p-2 rounded text-sm" placeholder="919800000000">
                        </div>
                        <div class="flex gap-2 mb-4">
                            <button onclick="sendWA('reminder')" class="bg-primary text-black px-4 py-2 rounded text-xs font-bold flex-1 hover:bg-yellow-400">Send Reminder</button>
                            <button onclick="sendWA('bank')" class="bg-secondary text-white px-4 py-2 rounded text-xs font-bold flex-1 hover:bg-blue-700">Send Bank Details</button>
                        </div>
                        <p class="text-xs text-gray-400">Note: This opens WhatsApp Web/App to send the message.</p>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
                        <h3 class="text-lg font-semibold text-secondary mb-4"><i class="fa-solid fa-qrcode"></i> CMB QR Generator</h3>
                        <div class="mb-4 text-left">
                            <label class="block text-xs font-bold text-gray-600 mb-1">Amount (â‚¹)</label>
                            <input type="number" id="qr-amount" class="w-full border p-2 rounded text-sm" placeholder="e.g. 5000">
                        </div>
                        <button onclick="generateQR()" class="bg-gray-800 text-white px-6 py-2 rounded text-sm font-bold w-full mb-4">Generate QR</button>
                        
                        <div id="qrcode-container" class="flex justify-center p-4 border border-dashed rounded hidden">
                            <div id="qrcode"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="placeholder-view" class="view-section">
                <div class="text-center py-20 text-gray-400">
                    <i class="fa-solid fa-person-digging text-5xl mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-600" id="placeholder-title">Module Loading...</h2>
                    <p>This module requires connection to the Ledger/Transaction database.</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- CONFIGURATION ---
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw81BknttHKeCsDL665WrVXQMVBDNAuolWPydmNVFG7KapRU1PBR4sOoU1Zp3yRRYhF/exec"; 

        // 1. Navigation Logic
        function toggleSub(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        function navigate(viewId, element, title) {
            // Update Sidebar Active State
            if(element) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                element.classList.add('active');
            }
            
            // Show View
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');

            // Update Header Title
            if(title) {
                document.getElementById('page-title').innerText = title;
                if(viewId === 'placeholder-view') {
                    document.getElementById('placeholder-title').innerText = title;
                }
            } else if (element) {
                document.getElementById('page-title').innerText = element.innerText;
            }
        }

        // 2. Form Submission Logic (To Google Sheets)
        function submitData(e, action, formId) {
            e.preventDefault();
            const form = document.getElementById(formId);
            const loader = document.getElementById('loader-' + formId);
            
            // Show Loader
            loader.style.display = 'inline-block';

            const formData = new FormData(form);
            const data = new URLSearchParams(formData);
            data.append("action", action);

            fetch(WEB_APP_URL, {
                method: "POST",
                body: data
            })
            .then(res => res.json())
            .then(response => {
                loader.style.display = 'none';
                if(response.result === 'success') {
                    alert(response.message);
                    form.reset();
                } else {
                    alert("Error: " + response.message);
                }
            })
            .catch(error => {
                loader.style.display = 'none';
                alert("Connection Failed! Check Web App URL.");
                console.error(error);
            });
        }

        // 3. CRM Logic
        function sendWA(type) {
            const mobile = document.getElementById('wa-mobile').value;
            if(!mobile) { alert("Enter Mobile Number"); return; }
            
            let msg = "";
            if(type === 'reminder') {
                msg = "Hello, This is a gentle reminder regarding your outstanding payment for CMB ERP. Please clear it at the earliest.";
            } else if (type === 'bank') {
                msg = "Bank Details for Payment:\nBank: HDFC Bank\nAcc: 1234567890\nIFSC: HDFC000123\nUPI: cmb@upi";
            }
            
            window.open(`https://wa.me/${mobile}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function generateQR() {
            const amount = document.getElementById('qr-amount').value;
            const container = document.getElementById('qrcode-container');
            const qrDiv = document.getElementById('qrcode');
            
            qrDiv.innerHTML = ""; // Clear old
            container.classList.remove('hidden');
            
            if(!amount) { alert("Enter Amount"); return; }

            // UPI String format
            const upiString = `upi://pay?pa=yoursupi@upi&pn=CMBooks&am=${amount}&tn=Payment`;
            
            new QRCode(qrDiv, {
                text: upiString,
                width: 150,
                height: 150,
                colorDark : "#1F70D3",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }
    </script>
</body>
</html>
