<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMB ERP | Accounting & CRM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F6b936',   /* CMB Yellow */
              secondary: '#1F70D3', /* CMB Blue */
              danger: '#D60000',
              zohoDark: '#1c212e',
              zohoGray: '#f4f5f7'
            },
            fontFamily: {
              poppins: ['Poppins', 'sans-serif']
            }
          }
        }
      }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f5f7; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: #1c212e; color: #cfd0d4; height: 100vh; display: flex; flex-direction: column; flex-shrink: 0; transition: 0.3s; }
        .brand { padding: 20px; font-size: 20px; font-weight: 700; color: white; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 10px; }
        .brand img { height: 30px; } /* For logocmb.png */
        
        .menu-group { margin-top: 10px; }
        .menu-label { font-size: 11px; text-transform: uppercase; color: #6c757d; padding: 10px 20px 5px; font-weight: 700; letter-spacing: 1px; }
        
        .nav-item { padding: 10px 20px; cursor: pointer; display: flex; align-items: center; font-size: 13px; border-left: 3px solid transparent; transition: 0.2s; color: #cfd0d4; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: #fff; border-left-color: #F6b936; }
        .nav-item i { width: 25px; font-size: 16px; }
        .nav-arrow { margin-left: auto; font-size: 10px; }

        /* SUBMENU */
        .submenu { display: none; background: rgba(0,0,0,0.2); }
        .submenu a { display: block; padding: 8px 20px 8px 50px; font-size: 12px; color: #a0a6b5; cursor: pointer; }
        .submenu a:hover { color: #fff; }

        /* CRM HIGHLIGHT */
        .crm-box { margin: 15px; background: linear-gradient(135deg, #1F70D3 0%, #10488d 100%); padding: 15px; border-radius: 8px; color: white; border: 1px solid #F6b936; }
        .crm-btn { background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; font-size: 11px; margin-top: 5px; display: block; text-align: center; cursor: pointer; }
        .crm-btn:hover { background: rgba(255,255,255,0.3); }

        /* MAIN CONTENT */
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100vh; }
        .topbar { background: white; height: 60px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; }
        .content-area { padding: 25px; overflow-y: auto; flex: 1; }

        /* FORMS */
        .zoho-form { background: white; padding: 30px; border-radius: 8px; border: 1px solid #e5e7eb; max-width: 900px; margin: 0 auto; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .form-header { font-size: 18px; font-weight: 600; color: #1F70D3; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .form-label { display: block; font-size: 12px; font-weight: 600; color: #4b5563; margin-bottom: 5px; }
        .form-input { width: 100%; border: 1px solid #d1d5db; padding: 8px 12px; border-radius: 4px; font-size: 13px; outline: none; transition: 0.2s; }
        .form-input:focus { border-color: #1F70D3; box-shadow: 0 0 0 2px rgba(31,112,211,0.1); }
        .btn-save { background-color: #1F70D3; color: white; padding: 10px 25px; border-radius: 4px; font-size: 14px; font-weight: 500; border: none; cursor: pointer; }
        .btn-save:hover { background-color: #16509c; }

        /* VIEWS */
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <div class="w-8 h-8 bg-primary rounded flex items-center justify-center text-white font-bold">C</div>
            <div>CMB ERP <span class="text-[10px] text-gray-400 block font-normal">v-Alpha1</span></div>
        </div>

        <div class="nav-item active" onclick="showView('view-company', this)">
            <i class="fa-solid fa-building"></i> Company Profile
        </div>

        <div class="menu-group">
            <div class="menu-label">Create</div>
            <div class="nav-item" onclick="toggleSub('sub-create')">
                <i class="fa-solid fa-folder-plus"></i> Masters <i class="fa-solid fa-chevron-down nav-arrow"></i>
            </div>
            <div class="submenu" id="sub-create">
                <a onclick="showView('view-ledger', null, 'Ledger')">Ledgers</a>
                <a onclick="showView('view-placeholder', null, 'Project Name')">Project Name</a>
                <a onclick="showView('view-placeholder', null, 'Project Stage')">Project Stage</a>
                <a onclick="showView('view-placeholder', null, 'Stock Item')">Stock Items</a>
            </div>
        </div>

        <div class="menu-group">
            <div class="menu-label">Transactions</div>
            <div class="nav-item" onclick="toggleSub('sub-accounts')">
                <i class="fa-solid fa-file-invoice-dollar"></i> Accounts Entry <i class="fa-solid fa-chevron-down nav-arrow"></i>
            </div>
            <div class="submenu" id="sub-accounts">
                <a onclick="showView('view-voucher', null, 'Cash Book')">Cash Book</a>
                <a onclick="showView('view-voucher', null, 'Bank Book')">Bank Book</a>
                <a onclick="showView('view-voucher', null, 'Payment')">Payment</a>
                <a onclick="showView('view-voucher', null, 'Receipt')">Receipt</a>
                <a onclick="showView('view-voucher', null, 'Sales')">Sales / Invoice</a>
                <a onclick="showView('view-voucher', null, 'Credit Note')">Sales Return</a>
                <a onclick="showView('view-voucher', null, 'Debit Note')">Purchase Return</a>
            </div>
        </div>

        <div class="menu-group">
            <div class="menu-label">Reports</div>
            <div class="nav-item" onclick="toggleSub('sub-reports')">
                <i class="fa-solid fa-chart-pie"></i> Financial Reports <i class="fa-solid fa-chevron-down nav-arrow"></i>
            </div>
            <div class="submenu" id="sub-reports">
                <a onclick="showView('view-placeholder', null, 'Ledger Report')">Ledgerwise Report</a>
                <a onclick="showView('view-placeholder', null, 'P&L Statement')">Profit & Loss</a>
                <a onclick="showView('view-placeholder', null, 'Balance Sheet')">Balance Sheet</a>
                <a onclick="showView('view-placeholder', null, 'GST Reports')">GST Reports (R1/3B)</a>
            </div>
        </div>

        <div class="crm-box">
            <div class="flex items-center gap-2 font-bold mb-2 text-primary">
                <i class="fa-solid fa-bolt"></i> SMART CRM
            </div>
            <p class="text-[10px] text-gray-200 mb-2">Engage Customers & Vendors</p>
            <div class="crm-btn" onclick="showView('view-crm')"><i class="fa-brands fa-whatsapp"></i> Send Reminders</div>
            <div class="crm-btn" onclick="showView('view-crm')"><i class="fa-solid fa-qrcode"></i> Payment QR</div>
        </div>

        <div class="menu-group">
            <div class="nav-item" onclick="showView('view-users', this)">
                <i class="fa-solid fa-users-gear"></i> User Management
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header class="topbar">
            <h2 id="page-title" class="text-lg font-semibold text-gray-700">Company Creation</h2>
            <div class="flex items-center gap-3">
                <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded border border-yellow-200">Licence: Active</span>
                <div class="w-8 h-8 bg-secondary rounded-full text-white flex items-center justify-center font-bold">A</div>
            </div>
        </header>

        <div class="content-area">
            
            <div id="view-company" class="view-section active">
                <div class="zoho-form">
                    <div class="form-header">Company Information</div>
                    <form id="form-company" onsubmit="submitData(event, 'save_company', 'form-company')">
                        <div class="grid grid-cols-2 gap-5 mb-4">
                            <div>
                                <label class="form-label">Company Name</label>
                                <input type="text" name="companyName" class="form-input" placeholder="Lotus Enterprises" required>
                            </div>
                            <div>
                                <label class="form-label">Mailing Name</label>
                                <input type="text" name="mailingName" class="form-input">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Address Line 1</label>
                            <textarea name="address" rows="2" class="form-input"></textarea>
                        </div>
                        <div class="grid grid-cols-3 gap-5 mb-4">
                            <div>
                                <label class="form-label">State</label>
                                <select name="state" class="form-input">
                                    <option>Kerala</option>
                                    <option>Tamil Nadu</option>
                                    <option>Karnataka</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">GSTIN</label>
                                <input type="text" name="gstin" class="form-input" placeholder="29ABCDE1234F1Z5">
                            </div>
                            <div>
                                <label class="form-label">Financial Year From</label>
                                <input type="date" name="fy" class="form-input" value="2025-04-01">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-5 mb-6">
                            <div>
                                <label class="form-label">Mobile</label>
                                <input type="text" name="mobile" class="form-input">
                            </div>
                            <div>
                                <label class="form-label">Email</label>
                                <input type="email" name="email" class="form-input">
                            </div>
                        </div>
                        <button type="submit" class="btn-save">Save Company</button>
                    </form>
                </div>
            </div>

            <div id="view-ledger" class="view-section">
                <div class="zoho-form">
                    <div class="form-header">Create Ledger</div>
                    <form id="form-ledger" onsubmit="submitData(event, 'save_ledger', 'form-ledger')">
                        <div class="mb-4">
                            <label class="form-label">Ledger Name</label>
                            <input type="text" name="ledgerName" class="form-input" required>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Under Group</label>
                            <select name="group" class="form-input">
                                <option>Sundry Debtors</option>
                                <option>Sundry Creditors</option>
                                <option>Bank Accounts</option>
                                <option>Sales Accounts</option>
                                <option>Indirect Expenses</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-5 mb-4">
                            <div>
                                <label class="form-label">State</label>
                                <input type="text" name="state" class="form-input" value="Kerala">
                            </div>
                            <div>
                                <label class="form-label">Opening Balance</label>
                                <input type="number" name="openingBal" class="form-input" placeholder="0.00">
                            </div>
                        </div>
                        <button type="submit" class="btn-save">Save Ledger</button>
                    </form>
                </div>
            </div>

            <div id="view-voucher" class="view-section">
                <div class="zoho-form">
                    <div class="form-header flex justify-between">
                        <span id="voucher-title">Accounting Voucher</span>
                        <span class="text-sm bg-gray-100 px-2 py-1 rounded text-gray-500">Auto ID</span>
                    </div>
                    <form id="form-voucher" onsubmit="submitData(event, 'save_transaction', 'form-voucher')">
                        <input type="hidden" name="voucherType" id="hidden-voucher-type" value="Payment">
                        <div class="grid grid-cols-3 gap-5 mb-4 p-4 bg-blue-50 rounded border border-blue-100">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="date" name="date" class="form-input bg-white">
                            </div>
                            <div class="col-span-2">
                                <label class="form-label">Ledger Name</label>
                                <input type="text" name="ledgerName" class="form-input bg-white" placeholder="Search Ledger...">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Particulars / Item Details</label>
                            <input type="text" name="particulars" class="form-input" placeholder="Description">
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Amount (₹)</label>
                            <input type="number" name="amount" class="form-input font-bold" placeholder="0.00">
                        </div>
                        <div class="mb-6">
                            <label class="form-label">Narration</label>
                            <textarea name="narration" rows="2" class="form-input"></textarea>
                        </div>
                        <div class="flex justify-between items-center">
                            <button type="button" class="text-sm text-green-600 font-medium hover:underline"><i class="fa-brands fa-whatsapp"></i> Share on WA</button>
                            <button type="submit" class="btn-save">Save Transaction</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="view-crm" class="view-section">
                <div class="grid grid-cols-2 gap-6 max-w-4xl mx-auto">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <div class="flex items-center gap-2 mb-4 text-green-600 text-lg font-bold">
                            <i class="fa-brands fa-whatsapp"></i> CRM Communicator
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Customer Mobile</label>
                            <input type="text" id="crm-mobile" class="form-input" placeholder="919946151111">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="sendWA('reminder')" class="bg-primary text-black px-4 py-2 rounded text-xs font-bold w-full hover:opacity-90">Send Reminder</button>
                            <button onclick="sendWA('bank')" class="bg-secondary text-white px-4 py-2 rounded text-xs font-bold w-full hover:opacity-90">Send Bank Details</button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
                        <div class="flex items-center gap-2 mb-4 text-secondary text-lg font-bold justify-center">
                            <i class="fa-solid fa-qrcode"></i> CMB QR Generator
                        </div>
                        <input type="number" id="qr-amount" class="form-input mb-4 text-center" placeholder="Enter Amount (₹)">
                        <button onclick="generateQR()" class="w-full bg-gray-800 text-white py-2 rounded text-sm font-bold hover:bg-black">Generate QR</button>
                        <div id="qrcode-display" class="mt-4 flex justify-center hidden p-4 border border-dashed rounded bg-gray-50"></div>
                    </div>
                </div>
            </div>

            <div id="view-users" class="view-section">
                <div class="zoho-form">
                    <div class="form-header">Add User</div>
                    <form id="form-users" onsubmit="submitData(event, 'add_user', 'form-users')">
                        <div class="grid grid-cols-2 gap-5 mb-4">
                            <div>
                                <label class="form-label">Username</label>
                                <input type="text" name="username" class="form-input" required>
                            </div>
                            <div>
                                <label class="form-label">Role</label>
                                <select name="role" class="form-input">
                                    <option>Admin</option>
                                    <option>Accountant</option>
                                    <option>Sales Team</option>
                                    <option>Viewer</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="form-label">Password</label>
                            <input type="password" name="password" class="form-input" required>
                        </div>
                        <button type="submit" class="btn-save">Create User</button>
                    </form>
                </div>
            </div>

            <div id="view-placeholder" class="view-section">
                <div class="text-center py-20 text-gray-400">
                    <i class="fa-solid fa-wrench text-4xl mb-3"></i>
                    <h3 class="text-xl font-medium text-gray-600" id="ph-title">Module Under Construction</h3>
                    <p class="text-sm">This feature is part of the full CMB ERP suite.</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        // CONFIGURATION: REPLACE THIS URL WITH YOUR DEPLOYED GOOGLE APPS SCRIPT URL
        const API_URL = "https://script.google.com/macros/s/AKfycbyk5tVo4j1IlR0hk77pqqLhqSA63jTB575f8C4HU8BH4zY5V2WMqGKsO1yYnunz7swb/exec";

        // 1. Navigation Logic
        function toggleSub(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        function showView(viewId, navEl, title) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            // Update Title
            if(title) {
                document.getElementById('page-title').innerText = title;
                if(viewId === 'view-voucher') document.getElementById('hidden-voucher-type').value = title;
                if(viewId === 'view-placeholder') document.getElementById('ph-title').innerText = title + " (Coming Soon)";
            } else if (navEl) {
                document.getElementById('page-title').innerText = navEl.innerText;
                // Highlight Nav
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                navEl.classList.add('active');
            }
        }

        // 2. Data Submission
        function submitData(e, action, formId) {
            e.preventDefault();
            const form = document.getElementById(formId);
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            
            btn.innerText = "Saving...";
            btn.disabled = true;

            const formData = new FormData(form);
            const params = new URLSearchParams(formData);
            params.append("action", action);

            fetch(API_URL, {
                method: "POST",
                body: params
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                if(data.result === "success") form.reset();
            })
            .catch(err => {
                alert("Error connecting to database. Check API URL.");
                console.error(err);
            })
            .finally(() => {
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }

        // 3. CRM Features
        function sendWA(type) {
            const mobile = document.getElementById('crm-mobile').value;
            if(!mobile) return alert("Enter Mobile Number");
            
            let msg = "";
            if(type === 'reminder') msg = "Hello, this is a gentle reminder regarding your outstanding payment. Please clear it at the earliest. - CMB ERP";
            else msg = "Bank Details for CMB ERP:\nBank: HDFC\nAcc: 123456789\nIFSC: HDFC001\nUPI: cmb@upi";
            
            window.open(`https://wa.me/${mobile}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function generateQR() {
            const amt = document.getElementById('qr-amount').value;
            if(!amt) return alert("Enter Amount");
            
            const display = document.getElementById('qrcode-display');
            display.innerHTML = "";
            display.classList.remove('hidden');
            
            const upiString = `upi://pay?pa=cmbooks@upi&pn=CMBooks&am=${amt}&tn=Payment`;
            
            new QRCode(display, {
                text: upiString,
                width: 120,
                height: 120,
                colorDark : "#1F70D3",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }
    </script>
</body>
</html>
