<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMB ERP | Accounting & CRM</title>
    
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#F6b936',   // CMB Yellow
              secondary: '#1F70D3', // CMB Blue
              danger: '#D60000',    // Red
              darkbg: '#2a2a3e',
              lightbg: '#f4f5f7'
            },
            fontFamily: {
              poppins: ['Poppins', 'sans-serif']
            }
          }
        }
      }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f5f7; overflow: hidden; }
        
        /* SIDEBAR TOGGLE ANIMATION */
        .sidebar { transition: width 0.3s ease; width: 260px; background: #fff; height: 100vh; position: fixed; z-index: 50; border-right: 1px solid #e5e7eb; display: flex; flex-direction: column; }
        .sidebar.collapsed { width: 70px; }
        .sidebar.collapsed .menu-text, .sidebar.collapsed .logo-text { display: none; }
        .sidebar.collapsed .menu-header { visibility: hidden; }
        
        /* SCROLLABLE CONTENT */
        .main-wrapper { margin-left: 260px; transition: margin-left 0.3s ease; height: 100vh; display: flex; flex-direction: column; }
        .main-wrapper.expanded { margin-left: 70px; }
        .content-scroll { overflow-y: auto; flex: 1; padding: 20px; }

        /* MENU ITEMS */
        .nav-item { display: flex; align-items: center; padding: 12px 20px; color: #4b5563; cursor: pointer; transition: 0.2s; border-right: 3px solid transparent; font-size: 14px; }
        .nav-item:hover { background: #f9fafb; color: #1F70D3; }
        .nav-item.active { background: #eff6ff; color: #1F70D3; border-right-color: #F6b936; font-weight: 600; }
        .nav-item i { width: 24px; font-size: 16px; }

        /* CRM BOX */
        .crm-box { margin: 15px; background: linear-gradient(135deg, #1F70D3 0%, #10488d 100%); border-radius: 10px; padding: 15px; color: white; position: relative; overflow: hidden; }
        .crm-box::after { content: ''; position: absolute; top: -10px; right: -10px; width: 50px; height: 50px; background: #F6b936; border-radius: 50%; opacity: 0.2; }
        
        /* FORMS */
        .cmb-input { width: 100%; border: 1px solid #d1d5db; padding: 8px 12px; border-radius: 6px; font-size: 13px; outline: none; transition: 0.2s; }
        .cmb-input:focus { border-color: #1F70D3; box-shadow: 0 0 0 2px rgba(31,112,211,0.1); }
        .cmb-label { display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 4px; }
    </style>
</head>
<body>

    <aside class="sidebar" id="sidebar">
        <div class="h-16 flex items-center justify-between px-5 border-b border-gray-100">
            <div class="flex items-center gap-2 logo-text">
                <div class="w-8 h-8 rounded bg-primary flex items-center justify-center text-white font-bold">C</div>
                <div>
                    <h1 class="font-bold text-secondary text-lg leading-none">CMB ERP</h1>
                    <p class="text-[10px] text-gray-400">Version Alpha1</p>
                </div>
            </div>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-secondary"><i class="fa-solid fa-bars"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto py-4">
            
            <div class="menu-header text-[10px] font-bold text-gray-400 uppercase tracking-wider px-5 mb-2 mt-2">Main</div>
            <div class="nav-item active" onclick="showView('dashboard-view', this)"><i class="fa-solid fa-grid-2"></i> <span class="menu-text ml-2">Dashboard</span></div>
            <div class="nav-item" onclick="showView('company-view', this)"><i class="fa-solid fa-building"></i> <span class="menu-text ml-2">Company</span></div>

            <div class="menu-header text-[10px] font-bold text-gray-400 uppercase tracking-wider px-5 mb-2 mt-4">Accounting</div>
            <div class="nav-item" onclick="showView('ledger-view', this)"><i class="fa-solid fa-book-open"></i> <span class="menu-text ml-2">Ledgers</span></div>
            <div class="nav-item" onclick="showView('voucher-view', this)"><i class="fa-solid fa-file-invoice-dollar"></i> <span class="menu-text ml-2">Vouchers</span></div>
            <div class="nav-item" onclick="showView('stock-view', this)"><i class="fa-solid fa-cubes"></i> <span class="menu-text ml-2">Stock</span></div>
            
            <div class="menu-header text-[10px] font-bold text-gray-400 uppercase tracking-wider px-5 mb-2 mt-4">Reports</div>
            <div class="nav-item" onclick="showView('report-view', this)"><i class="fa-solid fa-chart-pie"></i> <span class="menu-text ml-2">P&L / B-Sheet</span></div>
            <div class="nav-item" onclick="showView('report-view', this)"><i class="fa-solid fa-gavel"></i> <span class="menu-text ml-2">GST Reports</span></div>

            <div class="px-4 mt-6 menu-text">
                <div class="crm-box cursor-pointer" onclick="showView('crm-view', null)">
                    <h4 class="font-bold text-sm mb-2"><i class="fa-solid fa-bolt text-primary"></i> Smart CRM</h4>
                    <p class="text-xs opacity-80 mb-3">Send Updates, Bank Details & QR</p>
                    <button class="bg-white/20 w-full py-1.5 rounded text-xs font-medium hover:bg-white/30 transition">Open CRM</button>
                </div>
            </div>

            <div class="mt-auto border-t border-gray-100 pt-2">
                <div class="nav-item" onclick="showView('users-view', this)"><i class="fa-solid fa-users-gear"></i> <span class="menu-text ml-2">User Roles</span></div>
                <div class="nav-item text-danger"><i class="fa-solid fa-power-off"></i> <span class="menu-text ml-2">Quit</span></div>
            </div>
        </div>
    </aside>

    <div class="main-wrapper" id="main-wrapper">
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 sticky top-0 z-40">
            <h2 class="font-semibold text-gray-700" id="page-title">Dashboard</h2>
            
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p class="text-xs font-bold text-secondary">Lotus Enterprises</p>
                    <p class="text-[10px] text-gray-500">FY: 2025-2026</p>
                </div>
                <div class="w-9 h-9 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center text-secondary font-bold shadow-sm">
                    A
                </div>
            </div>
        </header>

        <div class="content-scroll">
            
            <div id="dashboard-view" class="view-section">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 border-l-4 border-l-secondary">
                        <p class="text-xs text-gray-500 font-semibold uppercase">Total Receivables</p>
                        <h3 class="text-xl font-bold text-gray-800 mt-1">₹ 1,24,500</h3>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 border-l-4 border-l-primary">
                        <p class="text-xs text-gray-500 font-semibold uppercase">Total Payables</p>
                        <h3 class="text-xl font-bold text-gray-800 mt-1">₹ 45,000</h3>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 border-l-4 border-l-green-500">
                        <p class="text-xs text-gray-500 font-semibold uppercase">Cash in Hand</p>
                        <h3 class="text-xl font-bold text-gray-800 mt-1">₹ 12,250</h3>
                    </div>
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 border-l-4 border-l-indigo-500">
                        <p class="text-xs text-gray-500 font-semibold uppercase">Bank Balance</p>
                        <h3 class="text-xl font-bold text-gray-800 mt-1">₹ 5,60,000</h3>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">
                    <button class="p-3 bg-white border border-gray-200 rounded hover:border-secondary hover:text-secondary text-sm font-medium transition" onclick="showView('voucher-view')">
                        <i class="fa-solid fa-plus-circle mb-1 block text-lg"></i> Sales
                    </button>
                    <button class="p-3 bg-white border border-gray-200 rounded hover:border-secondary hover:text-secondary text-sm font-medium transition" onclick="showView('voucher-view')">
                        <i class="fa-solid fa-cart-shopping mb-1 block text-lg"></i> Purchase
                    </button>
                    <button class="p-3 bg-white border border-gray-200 rounded hover:border-secondary hover:text-secondary text-sm font-medium transition" onclick="showView('voucher-view')">
                        <i class="fa-solid fa-receipt mb-1 block text-lg"></i> Receipt
                    </button>
                    <button class="p-3 bg-white border border-gray-200 rounded hover:border-secondary hover:text-secondary text-sm font-medium transition" onclick="showView('voucher-view')">
                        <i class="fa-solid fa-paper-plane mb-1 block text-lg"></i> Payment
                    </button>
                </div>
            </div>

            <div id="company-view" class="view-section hidden">
                <div class="bg-white max-w-4xl mx-auto rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                        <h3 class="font-semibold text-gray-800">Company Creation</h3>
                        <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">CMB401</span>
                    </div>
                    <form id="form-company" onsubmit="submitData(event, 'save_company')" class="p-6">
                        <div class="grid grid-cols-2 gap-5 mb-4">
                            <div>
                                <label class="cmb-label">Company Name</label>
                                <input type="text" name="companyName" class="cmb-input" placeholder="Lotus Enterprises" required>
                            </div>
                            <div>
                                <label class="cmb-label">Mailing Name</label>
                                <input type="text" name="mailingName" class="cmb-input">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="cmb-label">Address</label>
                            <textarea name="address1" rows="2" class="cmb-input" placeholder="Thalassery, Kannur"></textarea>
                        </div>
                        <div class="grid grid-cols-3 gap-5 mb-4">
                            <div>
                                <label class="cmb-label">State</label>
                                <select name="state" class="cmb-input">
                                    <option>Kerala</option>
                                    <option>Tamil Nadu</option>
                                    <option>Karnataka</option>
                                </select>
                            </div>
                            <div>
                                <label class="cmb-label">Pincode</label>
                                <input type="text" name="pincode" class="cmb-input">
                            </div>
                            <div>
                                <label class="cmb-label">Mobile</label>
                                <input type="text" name="mobile" class="cmb-input" placeholder="+91">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-5 mb-6">
                            <div>
                                <label class="cmb-label">Financial Year From</label>
                                <input type="date" name="fyBegin" class="cmb-input" value="2025-04-01">
                            </div>
                            <div>
                                <label class="cmb-label">GSTIN</label>
                                <input type="text" name="gstin" class="cmb-input" placeholder="32AAAAA0000A1Z5">
                            </div>
                        </div>
                        <div class="flex justify-end gap-3">
                            <button type="button" class="px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                            <button type="submit" class="px-6 py-2 bg-secondary text-white text-sm font-medium rounded hover:bg-blue-700 shadow-sm transition">Save Company</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="ledger-view" class="view-section hidden">
                <div class="bg-white max-w-2xl mx-auto rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                        <h3 class="font-semibold text-gray-800">Ledger Creation</h3>
                    </div>
                    <form id="form-ledger" onsubmit="submitData(event, 'save_ledger')" class="p-6">
                        <div class="mb-4">
                            <label class="cmb-label">Ledger Name</label>
                            <input type="text" name="ledgerName" class="cmb-input" required>
                        </div>
                        <div class="mb-4">
                            <label class="cmb-label">Under Group</label>
                            <select name="underGroup" class="cmb-input">
                                <option>Sundry Debtors</option>
                                <option>Sundry Creditors</option>
                                <option>Bank Accounts</option>
                                <option>Sales Accounts</option>
                                <option>Purchase Accounts</option>
                                <option>Indirect Expenses</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-5 mb-4">
                            <div>
                                <label class="cmb-label">State</label>
                                <input type="text" name="state" class="cmb-input" value="Kerala">
                            </div>
                            <div>
                                <label class="cmb-label">Opening Balance</label>
                                <div class="flex gap-2">
                                    <input type="number" name="openingBalance" class="cmb-input" placeholder="0.00">
                                    <select name="crDr" class="cmb-input w-20">
                                        <option>Dr</option>
                                        <option>Cr</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full py-2 bg-primary text-gray-900 text-sm font-bold rounded hover:bg-yellow-400 shadow-sm transition">Create Ledger</button>
                    </form>
                </div>
            </div>

            <div id="voucher-view" class="view-section hidden">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-6 py-3 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                        <h3 class="font-semibold text-gray-800">Accounting Voucher</h3>
                        <div class="text-sm">
                            <span class="text-gray-500">No:</span> <span class="font-bold text-secondary">INV2526/001</span>
                        </div>
                    </div>
                    <form id="form-voucher" onsubmit="submitData(event, 'save_voucher')" class="p-6">
                        <div class="grid grid-cols-4 gap-4 mb-4 bg-blue-50 p-3 rounded border border-blue-100">
                            <div>
                                <label class="cmb-label">Voucher Type</label>
                                <select name="voucherType" class="cmb-input bg-white">
                                    <option>Sales</option>
                                    <option>Purchase</option>
                                    <option>Payment</option>
                                    <option>Receipt</option>
                                    <option>Journal</option>
                                    <option>Contra</option>
                                </select>
                            </div>
                            <div>
                                <label class="cmb-label">Date</label>
                                <input type="date" name="date" class="cmb-input bg-white">
                            </div>
                            <div class="col-span-2">
                                <label class="cmb-label">Party A/c Name</label>
                                <input type="text" name="ledgerName" class="cmb-input bg-white" placeholder="Search Ledger...">
                            </div>
                        </div>

                        <table class="w-full text-sm text-left border-collapse mb-4">
                            <thead class="bg-gray-100 text-gray-600 border-b">
                                <tr>
                                    <th class="py-2 px-2 font-medium w-1/2">Particulars</th>
                                    <th class="py-2 px-2 font-medium text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2 border-b"><input type="text" name="particulars" class="w-full outline-none" placeholder="Item / Service Name"></td>
                                    <td class="p-2 border-b"><input type="number" name="amount" class="w-full outline-none text-right" placeholder="0.00"></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="mb-4">
                            <label class="cmb-label">Narration</label>
                            <textarea name="narration" rows="2" class="cmb-input"></textarea>
                        </div>

                        <div class="flex justify-between items-center">
                            <div class="flex gap-3">
                                <button type="button" class="text-xs text-gray-500 hover:text-gray-700"><i class="fa-solid fa-print"></i> Print</button>
                                <button type="button" class="text-xs text-green-600 hover:text-green-700"><i class="fa-brands fa-whatsapp"></i> WhatsApp</button>
                            </div>
                            <button type="submit" class="px-8 py-2 bg-secondary text-white text-sm font-medium rounded hover:bg-blue-700 transition">Save Voucher</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="crm-view" class="view-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <div class="flex items-center gap-2 mb-4 text-green-600">
                            <i class="fa-brands fa-whatsapp text-2xl"></i>
                            <h3 class="font-bold text-lg">Customer Updates</h3>
                        </div>
                        <div class="mb-4">
                            <label class="cmb-label">Customer Mobile</label>
                            <input type="number" id="crm-mobile" class="cmb-input" placeholder="919800000000">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="sendWA('reminder')" class="py-2 bg-gray-100 text-gray-700 rounded hover:bg-yellow-100 hover:text-yellow-700 text-sm transition">
                                Send Payment Reminder
                            </button>
                            <button onclick="sendWA('bank')" class="py-2 bg-gray-100 text-gray-700 rounded hover:bg-blue-100 hover:text-blue-700 text-sm transition">
                                Send Bank Details
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
                        <div class="flex items-center gap-2 mb-4 text-secondary justify-center">
                            <i class="fa-solid fa-qrcode text-2xl"></i>
                            <h3 class="font-bold text-lg">CMB Payment QR</h3>
                        </div>
                        <input type="number" id="qr-amount" class="cmb-input mb-4 text-center" placeholder="Enter Amount (₹)">
                        <button onclick="generateQR()" class="w-full py-2 bg-gray-900 text-white rounded text-sm hover:bg-black transition">Generate UPI QR</button>
                        <div id="qrcode-display" class="mt-4 flex justify-center hidden p-4 border border-dashed rounded bg-gray-50"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // CONFIGURATION: PASTE YOUR GOOGLE APPS SCRIPT URL HERE
        const API_URL = "https://script.google.com/macros/s/AKfycbzITfnDbzzIMkNWCsmFelDJcXB5uX1mlcRa9_5sAkC1Kf5QpKMTkFmUzxqma5YclTAC/exec"; 

        // 1. Navigation
        function showView(viewId, navElement) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            if(navElement) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                navElement.classList.add('active');
                document.getElementById('page-title').innerText = navElement.querySelector('.menu-text').innerText;
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('main-wrapper').classList.toggle('expanded');
        }

        // 2. Form Submission
        function submitData(e, action) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            
            btn.innerText = "Saving...";
            btn.disabled = true;

            const formData = new FormData(form);
            const params = new URLSearchParams(formData);
            params.append("action", action);

            fetch(API_URL, { method: "POST", body: params })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                if(data.result === 'success') form.reset();
            })
            .catch(err => alert("Error: " + err))
            .finally(() => {
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }

        // 3. CRM Tools
        function sendWA(type) {
            const num = document.getElementById('crm-mobile').value;
            if(!num) return alert("Enter Mobile Number");
            let msg = type === 'reminder' 
                ? "Gentle Reminder: Your payment is pending with Lotus Enterprises. Please clear it soon." 
                : "Bank Details: Lotus Enterprises, HDFC Bank, Acc: 123456, IFSC: HDFC001";
            window.open(`https://wa.me/${num}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function generateQR() {
            const amt = document.getElementById('qr-amount').value;
            if(!amt) return alert("Enter Amount");
            const div = document.getElementById('qrcode-display');
            div.innerHTML = "";
            div.classList.remove('hidden');
            
            // UPI String (Replace with your VPA)
            const upi = `upi://pay?pa=cmbooks@upi&pn=LotusEnterprises&am=${amt}&tn=CMB_Payment`;
            
            new QRCode(div, {
                text: upi,
                width: 128,
                height: 128,
                colorDark : "#1F70D3",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }
    </script>
</body>
</html>
