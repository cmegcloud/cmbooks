function doPost(e) {
  try {
    const ss = SpreadsheetApp.openById('1PMYDjR3Uy-2FAJiEsJwYKK0zWkm1oZpAFiOQDjKsSs4');
    const input = JSON.parse(e.postData.contents);
    const sheet = ss.getSheetByName(input.sheet);
    let row = [];

    if (input.sheet === "COMPANY") {
      const id = "CMB" + (4000 + sheet.getLastRow()); // Auto CMB4001
      row = [
        id, input.companyDataPath || "", input.companyName, input.constitution, 
        input.address1, input.address2 || "", input.state, "India", input.pincode, 
        "", input.mobile, input.whatsapp || "", input.email, "", "", "", "â‚¹", "INR"
      ];
    } 
    else if (input.sheet === "STOCK") {
      const id = "STK" + (1000 + sheet.getLastRow());
      row = [
        id, input.name, input.under, input.units, "Applicable", 
        input.hsnDetails || "", "Manual", "", input.gstRate, "Goods", "0", 
        input.openingBalance, input.crDr
      ];
    }
    else if (input.sheet === "LEDGER") {
      const id = "LDG" + (1000 + sheet.getLastRow());
      row = [id, input.ledgerName, input.under || "", input.openingBalance, input.crDr];
    }
    else if (input.sheet === "TRANSACTION") {
      const id = "TRN" + (5000 + sheet.getLastRow());
      row = [id, input.voucherType, input.date, input.ledgerName, "", "", input.amount, input.narration || ""];
    }
    else if (input.sheet === "PROJECTS") {
      const id = "PRJ" + (100 + sheet.getLastRow());
      row = [id, input.projectName, input.estimatedAmount || "0", input.narration || ""];
    }
    else if (input.sheet === "ESTIMATE") {
      const id = "EST" + (2000 + sheet.getLastRow());
      row = [
        id, input.date, input.customerName, input.item || "", "", 
        input.gstPercent || "0", input.amount || "0", "", input.discount || "0", 
        "", "", input.grandTotal, ""
      ];
    }

    if (row.length > 0) {
      sheet.appendRow(row);
    }
    
    return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
  } catch (err) {
    return ContentService.createTextOutput("Error: " + err.message).setMimeType(ContentService.MimeType.TEXT);
  }
}
